<!DOCTYPE html>
<html>
	<head>
		<title>File reformatter</title>
	</head>
	<body>
		<div id="inputs">
			<select id="reformatter">
				<!-- options will be generated via javascript -->
			</select>
			<div id="arguments">
				<!-- arguments will be generated via javascript -->
			</div>
			<button id="submit" disabled="disabled">Reformat</button>
		</div>
		<input type="text" id="result" />
		<script
			src="https://code.jquery.com/jquery-3.2.1.min.js"
			integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
			crossorigin="anonymous"></script>
		<script type="text/javascript">
			if (!window.Worker) {
				alert('This website can not be used, because your browser does not support the Worker api!');
			} else {
var reformatters = [new Reformatter('Replacer', ['replace', 'with'])];
reformatters.forEach(function(r) {
	reformatters[r.name] = r;
});
var selectedReformatter = null;

$(document).ready(function() {
	$('#reformatter').html(
		'<option value="">-----</option>' + 
		reformatters
			.map(function(r) { 
				return '<option value="' + r.name + '">' + r.name + '</option>';
			})
			.join("\n")
	).change(function(e) {
		var selectedReformatterName = $(e.target).val();
		selectedReformatter = selectedReformatterName === '' ? null : reformatters[selectedReformatterName];
		$('#submit').attr('disabled', selectedReformatter === null);
		if (selectedReformatter) {
			$('#arguments').html(
				'Input: <input type="text" />' + 
				selectedReformatter.argumentNames.map(function(a, i) {
					return a + ': <input type="text" />';
				})
			);
		} else {
			$('#arguments').html('');
		}
	});
	
	$('#submit').click(function() {
		var args = [];
		$('#arguments input').each(function(i, e) {
			args[i] = $(e).val();
		});
		selectedReformatter.reformat(args);
	});
});

function Reformatter(name, argumentNames) {
	this.name = name;
	this.argumentNames = argumentNames;
	this.worker = null;
}
Reformatter.prototype.reformat = function(args) {
	if (this.worker === null) {
		this.worker = new Worker('reformatters/' + this.name + '.js');
		this.worker.onmessage = function(e) {
			$('#result').val(e.data);
		};
	}
	this.worker.postMessage(args);
}
			}
		</script>
	</body>
</html>
